---
title: "data"
output: github_document
date: "2022-12-14"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(readxl)
library(corrplot)
library(performance)
library(car)
```


```{r import data}
body_df=read_excel("data/body_density_data.xlsx") %>%
  janitor::clean_names() %>%
  select(-bodyfat_brozek,-body_density,-id)
```

```{r descriptive stat}
# all are continuous data

sum = function(variable){
  tibble(
    mean = mean(variable),
    sd = sd(variable),
    median = median(variable),
    maximum = max(variable),
    minimum = min(variable),
    IQR = IQR(variable)
  )
}

table=map(body_df, sum) %>% 
  bind_rows() %>% 
  mutate(variable = names(body_df)) %>% 
  select(variable,everything()) %>% 
  filter(variable!="id") %>%
  knitr::kable(digits = 2, 
               caption = "Descriptive statistics of continuous variables") 

table
```

```{r correlation}
# check multicollinearity
body_corr=
body_df %>% 
cor() 
png(height=1800,width=1800,file="plots/corr.png",type="cairo")
corr=corrplot(cor(body_corr), 
         method = "color", 
         type = "upper",
         addCoef.col = "black", 
         number.cex = 0.6,
         diag = FALSE) 


```

```{r}

#Raw VIF
mult.fit <- lm(bodyfat_siri ~ .,data = body_df)
vif_val <- vif(mult.fit)
name <- str_to_title (names(vif_val))
vifdf <- 
  tibble(variable = name, vif = vif_val) %>%
  mutate(variable = fct_reorder(variable,vif_val))
ggplot(data = vifdf,aes(y = variable, x = vif_val)) +
  geom_col() +
  geom_vline(xintercept = 5,colour="red",linetype = "longdash") +
 theme_bw()



interactions::interact_plot(update(mult.fit, . ~ . + age*wrist),pred = wrist, modx = age)

```


```{r}
raw_fit=lm(bodyfat_siri~.,data=body_df)
summary(raw_fit)
```

```{r}
bf_data=body_df %>%
select(-weight,-hip,-chest,-thigh) 
write_csv(bf_data,"data/bf_data.csv")

mult.fit2 <- lm(bodyfat_siri ~ .,data = bf_data)
vif_val <- vif(mult.fit2)
name <- str_to_title (names(vif_val))
vifdf <- 
  tibble(variable = name, vif = vif_val) %>%
  mutate(variable = fct_reorder(variable,vif_val))
ggplot(data = vifdf,aes(y = variable, x = vif_val)) +
  geom_col() +
  geom_vline(xintercept = 5,colour="red",linetype = "longdash") +
 theme_bw()


```

```{r  check outcome variable}
boxplot(body_df$bodyfat_siri,main='Percent body fat using Siriâ€™s equation')

```

```{r}
body_df%>% select(-bodyfat_siri)%>%
  funModeling::plot_num()
```